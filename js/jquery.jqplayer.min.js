/**!

	jQPlayer - HTML 5 Video Player Plugin for jQuery
	Version: 0.5
	Site: http://jqplayer.vebersol.net/
	
	Author: Vin√≠cius Ebersol
	Designer: Thiago Reis
	
	License: MIT License
	
*/
var options;(function(e){var t=function(e,t){this.selector=e;this.options=t;this.idCounter=0;this.playing=false;this.supportHTML5=true;this.posterVisible=false;this.init()};t.prototype={init:function(){var e=document.createElement("video");if(e.canPlayType){this.supportHTML5=true;return this.start()}else{this.supportHTML5=false;var t=false;try{var n=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");if(n){t=true}}catch(r){if(navigator.mimeTypes["application/x-shockwave-flash"]!=undefined){t=true}}if(t){this.startFallback()}}},start:function(){this.getDefaultVideo();this.createVideoElement();this.createControls();this.bindControls();this.bindEvents();this.setupSubtitles();if(this.options.onStart){this.options.onStart.call()}},startFallback:function(){var e=this;this.supportHTML5=false;this.getDefaultVideo();this.createFlashElement();this.createControls();this.bindControls();this.bindEvents();this.setupSubtitles();if(this.options.onStart){this.options.onStart.call()}},adjustSubtitle:function(e){this.subtitleObj.count=0;this.subtitleObj.current=this.subtitleObj.content[this.subtitleObj.count];var t=this.supportHTML5?e.currentTime:e.currentTime(),n=parseFloat(t);while(this.getMaxTime()<n){this.updateSubtitle(e);if(this.subtitleObj.count>this.subtitleObj.content.length-1){this.subtitleObj.count=this.subtitleObj.content.length-1;break}}},bindControls:function(){var e=this;for(var t=0;t<this.options.controls.length;t++){switch(this.options.controls[t]){case"play":this.selector.find(e.getClass("play")).bind("click",function(){e.playPause()});break;case"progress":this.setupProgressBar();break;case"volume":this.selector.find(e.getClass("volume-button")).bind("click",function(){e.muteVideo()});break;case"fullscreen":this.selector.find(e.getClass("fullscreen")).bind("click",function(){e.toFullscreen()});break;default:break}}},bindEvents:function(){var t=this;var n=this.video.get(0);if(this.supportHTML5){n.addEventListener("loadedmetadata",function(){t.eventsToBind()},true);if(e.browser.webkit){e(document).bind("webkitfullscreenchange",function(){t.fullscreenEvent()})}else if(e.browser.mozilla){e(document).bind("mozfullscreenchange",function(){t.fullscreenEvent()})}}else{e(document).bind("flash.loaded",function(){t.eventsToBind()})}var r=function(){e(this).addClass("hover")};var i=function(){var n=e(this);if(n.hasClass(t.getClass("volume").replace(".",""))&&t.volumeFlag){return false}n.removeClass("hover")};e(this.getClass("play")).hover(r,i);e(this.getClass("volume")).hover(r,i);e(this.getClass("fullscreen")).hover(r,i);e(this.getClass("alternative-versions")).hover(r,i);this.selector.bind("mouseleave",function(e){e.preventDefault();if(t.playing){clearTimeout(t.inactivateTimer);t.inactivateTimer=setTimeout(function(){t.selector.find(t.getClass("video-controls")).addClass("inactive")},2e3)}});this.selector.bind("mouseenter",function(e){e.preventDefault();clearTimeout(t.inactivateTimer);t.selector.find(t.getClass("video-controls")).removeClass("inactive")});this.selector.find(this.getClass("video-controls")).bind("mousedown",function(e){e.preventDefault()});e(window).bind("resize",function(){t.setupProgressBar()})},blockSelection:function(){this.volumeFlag=true;document.onselectstart=function(){return false}},changeVideoSource:function(t){var n=e(t).parent().parent().parent();currentVersion=n.attr("class").replace(this.setClass("alternative-versions")+" ","");var r=n.find(this.getClass("current-version"));var i=e(t).parent().attr("class").replace("."+this.options.prefix+"alternative-","");if(currentVersion!=i){var s=this.options.videos[i];r.html(s.label);r.parent().removeClass(currentVersion).addClass(i);video=this.video.get(0);if(this.supportHTML5){video.pause()}else{video._pause()}this.resetVideo();if(this.supportHTML5){video.src=this.getVideoSource(s)}else{video.changeVideo(this.getVideoSource(s))}var o=e(this.getClass("alternative-versions")).find("ul");o.html("");for(i in this.options.videos){var u=this.options.videos[i];if(u!=s){if(u.source){var a=e('<li class="'+this.getClass("alternative-"+i)+'"><a href="javascript:;"><span></span></a></li>');if(u.label){a.find("span").html(u.label)}var f=this;a.find("a").bind("click",function(){f.changeVideoSource(this)});o.append(a)}}}var f=this;if(this.supportHTML5){video.addEventListener("loadedmetadata",function(){this.play();if(f.options.onVideoChange){f.options.onVideoChange.call()}},true)}}},createAlternative:function(){var t=e('<div class="'+this.setClass("alternative-versions")+'"></div>');t.append('<span class="'+this.setClass("current-version")+'">'+this.defaultVideo.label+"</span>");t.append("<ul></ul>");for(alternative in this.options.videos){var n=this.options.videos[alternative];if(n!=this.defaultVideo){if(n.source){var r=e('<li class="'+this.getClass("alternative-"+alternative)+'"><a href="javascript:;"><span></span></a></li>');if(n.label){r.find("span").html(n.label)}var i=this;r.find("a").bind("click",function(){i.changeVideoSource(this)});t.find("ul").append(r)}}else{t.addClass(alternative)}}return t},createButton:function(t,n){var r=e("<div>").addClass(this.setClass(n));var i=e("<span>").html(t);r.append(i);return r},createClearFloats:function(){return'<div style="clear:both;width:0;height:0;margin:0;padding:0;"><!-- --></div>'},createControls:function(){this.controls=e("<div>").addClass(this.setClass(this.options.controlsClass));for(var t=0;t<this.options.controls.length;t++){switch(this.options.controls[t]){case"play":var n=this.createButton("Play/Pause","play");this.controls.append(n);break;case"progress":var r=this.createProgressBar();this.controls.append(r);break;case"time":var i=this.createTimeDisplay();this.controls.append(i);break;case"volume":var s=this.createVolumeBar();this.controls.append(s);break;case"fullscreen":if(e.browser.webkit||e.browser.mozilla){var o=this.createButton("Fullscreen","fullscreen");this.controls.append(o)}break;case"alternative":var u=this.createAlternative();this.controls.append(u);break;default:var a=this.createCustomButton(this.options.controls[t]);this.controls.append(a);break}}this.controls.append(this.createClearFloats());this.selector.append(this.controls)},createCustomButton:function(t){var n=null;var r=this.options.customButtons[t];if(r){if(r.url){n=e('<div><a href="'+r.url+'"></a></div>');if(r.label)n.find("a").html(r.label);if(r.className){n.addClass(r.className)}if(r.target){n.find("a").attr("target",r.target)}}else if(r.onclick){n=e('<div><a href="javascript:;"></a></div>');n.find("a").bind("click",r.onclick);if(r.className)n.addClass(r.className);if(r.label)n.find("a").html(r.label)}n.addClass(this.setClass("custom-button"));return n}return false},createFlashElement:function(){this.createPoster();var t={allowScriptAccess:"always",movie:this.options.fallbackOptions.swf,allowNetworking:"all",wmode:"transparent",bgcolor:"#000000"};var n={video:this.getVideoSource()};var r="",i=this.setClass("fallback")+"_"+Math.floor(Math.random()*999);if(e.browser.msie){r=' id="'+i+'" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'}var s='<object type="application/x-shockwave-flash" width="100%" height="100%" data="'+this.options.fallbackOptions.swf+'" '+r+">";s+=this.addParams(t,n);s+="</object>";this.video=e(s);e(this.selector).append(this.video)},addParams:function(e,t){var n=[],r=[],i="<embed ";for(var s in t){r.push(s+"="+t[s])}e.flashvars=r.join("&");for(var o in e){n.push('<param name="'+o+'" value="'+e[o]+'">');i+=o+'="'+e[o]+'" '}i+=">";return n.join(" ")+i},createPoster:function(){if(this.defaultVideo.poster){var t=e('<img src="'+this.defaultVideo.poster+'" class="'+this.setClass("poster")+'">');this.selector.append(t);this.posterVisible=true}},createProgressBar:function(){var t=e("<div>").addClass(this.setClass("progress-bar"));var n=e("<div>").addClass(this.setClass("progress-wrapper"));var r=e("<div>").addClass(this.setClass("progress-play"));var i=e("<div>").addClass(this.setClass("progress-pointer"));var s=e("<div>").addClass(this.setClass("progress-buffer"));n.append(r);n.append(i);n.append(s);n.append(this.createClearFloats());t.append(n);return t},createTimeDisplay:function(){var t=e("<div>").addClass(this.setClass("time-display"));var n=e("<div>").addClass(this.setClass("time-current"));var r=e("<div>").addClass(this.setClass("time-separator"));var i=e("<div>").addClass(this.setClass("time-total"));t.append(n);t.append(r);t.append(i);return t},createVideoElement:function(){try{this.createPoster();this.video=e("<video>Your browser doesn't support video tag.</video>");this.video.attr("src",this.getVideoSource());this.video.width("100%");this.video.height("100%");if(this.defaultVideo.subtitle){this.video.append('<track src="'+this.defaultVideo.subtitle+'"></track>')}e(this.selector).append(this.video)}catch(t){this.supportHTML5=false;var n=e('<p class="'+this.setClass("error-message")+'"></p>').html("Your browser doesn't support html5 video. Try to setup a fallback in options.");e(this.selector).append(n)}},createVolumeBar:function(){var t=e("<div>").addClass(this.setClass("volume"));var n=e("<div>").addClass(this.setClass("volume-button")).html("Volume");var r=e("<div>").addClass(this.setClass("volume-bar"));var i=e("<div>").addClass(this.setClass("volume-icon-plus")).html("+");var s=e("<div>").addClass(this.setClass("volume-wrapper"));var o=e("<div>").addClass(this.setClass("volume-position"));var u=e("<div>").addClass(this.setClass("volume-icon-less")).html("-");s.append(o);r.append(i);r.append(s);r.append(u);t.append(n);t.append(r);return t},eventsToBind:function(){if(e.inArray("progress",this.options.controls)){this.setProgressEvents(this.video.get(0))}if(e.inArray("time",this.options.controls)){this.setupTime()}if(e.inArray("volume",this.options.controls)){this.volumeSetup()}},findPosX:function(e){e=e.get(0);var t=e.offsetLeft;while(e=e.offsetParent){t+=e.offsetLeft}return t},findPosY:function(e){e=e.get(0);var t=e.offsetTop;while(e=e.offsetParent){t+=e.offsetTop}return t},formatTime:function(e){var t=Math.floor(e/60);var n=Math.round(e-t*60);if(n==60){n=0;t=t+1}if(n<10){n="0"+n}return t+":"+n},fullscreenEvent:function(){var t=e(this.getClass("fullscreen"));t.toggleClass("fullscreen");if(!this.fullscreen){this.selector.addClass("fullscreen");t.removeClass("hover");this.fullscreen=true}else{this.selector.removeClass("fullscreen");t.removeClass("hover");this.fullscreen=false}this.setupProgressBar()},getClass:function(e){return"."+this.options.prefix+e},getControlsSize:function(){var t=0;var n=this;this.selector.find(this.getClass("video-controls")).children().each(function(){var r=e(this);if(!r.hasClass(n.setClass("progress-bar"))){t+=r.outerWidth()}});return t},getDefaultVideo:function(){if(this.options.videos[this.options.defaultVideo]){this.defaultVideo=this.options.videos[this.options.defaultVideo];return this.defaultVideo}for(var e in this.options.videos){this.defaultVideo=this.options.videos[e];return this.defaultVideo}},getMaxTime:function(){if(typeof this.subtitleObj.current!="undefined"){var e=this.subtitleObj.current[1].split(" --> ");return this.timecodeToSec(e[1])}},getMinTime:function(){if(typeof this.subtitleObj.current!="undefined"){var e=this.subtitleObj.current[1].split(" --> ");return this.timecodeToSec(e[0])}},getSubtitle:function(){return this.defaultVideo.subtitle},getVideoSource:function(t){if(!t){t=this.defaultVideo}if(this.supportHTML5&&(e.browser.safari&&!/Chrome[\/\s](\d+\.\d+)/.test(navigator.userAgent)||e.browser.msie)){return t.source.mp4}else if(!this.supportHTML5){return this.options.fallbackOptions.relativePath+t.source.mp4}if(t.source.ogg){return t.source.ogg}return t.source.webm},hideControls:function(e){e.animate({bottom:"-"+e.height()+"px"})},hidePoster:function(){this.selector.find(this.getClass("poster")).hide();this.posterVisible=false},incrementId:function(){var e=this.options.videoId+this.idCounter;this.idCounter++;return e},muteVideo:function(){var e=this.selector.find(this.getClass("volume-button"));var t=this.selector.find(this.getClass("volume-position"));var n=this.video.get(0);if(this.supportHTML5){if(n.muted){n.muted=false;e.removeClass("muted");t.height(n.volume*100+"%")}else{n.muted=true;e.addClass("muted");t.height(0)}}else{if(this.flashMuted){this.flashMuted=false;n.volume(this.flashVolume);e.removeClass("muted");t.height(this.flashVolume*100+"%")}else{this.flashMuted=true;this.flashVolume=n.getVolume();n.volume(0);e.addClass("muted");t.height(0)}}},pauseEvent:function(t){e(t).parent().find(this.getClass("play")).removeClass("playing").addClass("paused");if(this.options.onPause){this.options.onPause.call()}this.playing=false},playEvent:function(t){var n=this;var r=e(this.getClass("progress-buffer"));this.bufferInterval=setInterval(function(){n.updateBuffer(t,r)},1e3);e(t).parent().find(this.getClass("play")).removeClass("paused").addClass("playing");this.seekVideoSetup(t);if(this.options.onPlay){this.options.onPlay.call()}this.playing=true},playPause:function(){var e=this.video.get(0);if(this.supportHTML5){if(e.paused){e.play()}else{e.pause()}}else{if(e.paused()){e._play()}else{e._pause()}}},resetVideo:function(){this.controls.find(this.getClass("video-controls")+", "+this.getClass("progress-buffer")).css("width",0);clearInterval(this.bufferInterval)},seekTo:function(t,n,r){var i=e(this.getClass("progress-play"));var s=Math.max(0,Math.min(1,(t-this.findPosX(n))/n.width()));var o=s*(this.supportHTML5?r.duration:r.duration());if(this.supportHTML5){r.currentTime=o}else{r.seekTo(o)}var u=Math.round(s*n.width());i.width(u)},seekVideoSetup:function(t){var n=e(t).parent().find(this.getClass("progress-wrapper"));if(n.length>0){this.selectable=true;var r=this;n.bind("mousedown",function(i){i.preventDefault();r.blockSelection();e(document).bind("mousemove",function(e){e.preventDefault();r.seekTo(e.pageX,n,t)});e(document).bind("mouseup",function(t){t.preventDefault();r.unblockSelection();e(document).unbind("mousemove");e(document).unbind("mouseup")})});n.bind("mouseup",function(e){r.seekTo(e.pageX,n,t)})}},setClass:function(e){return this.options.prefix+e},setProgressEvents:function(t){var n=this;var r=e(this.getClass("progress-play"));var i=e(this.getClass("progress-buffer"));if(this.supportHTML5){t.addEventListener("seeked",function(){if(!t.paused)t.play();if(n.subtitleObj&&n.subtitleObj.loaded){n.adjustSubtitle(this)}if(n.options.onSeek){n.options.onSeek.call()}},true);t.addEventListener("ended",function(){r.width("100%");clearInterval(n.progressInterval);this.currentTime=0;this.pause();if(n.options.onEnd){n.options.onEnd.call()}n.playing=false},true);t.addEventListener("timeupdate",function(){n.updateVideoData(this,r);n.updateCurrentTime(this);if(n.subtitleObj&&n.subtitleObj.loaded){n.updateSubtitle(t)}},false);t.addEventListener("playing",function(){if(n.posterVisible){n.hidePoster()}n.playEvent(this)},true);t.addEventListener("pause",function(){n.pauseEvent(this)},true)}else{var s=n.video.get(0);this.flashInterval=setInterval(function(){n.updateVideoData(s,r);n.updateCurrentTime(s);if(n.subtitleObj&&n.subtitleObj.loaded){n.updateSubtitle(s)}},500);e(document).bind("flash.play",function(){if(n.posterVisible){n.hidePoster()}n.playEvent(s)});e(document).bind("flash.pause",function(){n.pauseEvent(s)});e(document).bind("flash.seeked",function(){clearTimeout(n.seekTimeout);n.seekTimeout=setTimeout(function(){if(!s.paused())s._play();if(n.subtitleObj&&n.subtitleObj.loaded){n.adjustSubtitle(s)}if(n.options.onSeek){n.options.onSeek.call()}},200)});e(document).bind("flash.videoChanged",function(){s._play();if(n.subtitleObj&&n.subtitleObj.loaded){n.adjustSubtitle(s)}if(n.options.onVideoChange){n.options.onVideoChange.call()}});e(document).bind("flash.end",function(){if(n.options.onEnd){n.options.onEnd.call()}})}},setupProgressBar:function(){var e=this.selector.find(this.getClass("progress-bar"));var t=this.selector.width();var n=t-parseInt(this.getControlsSize());e.parent().width(t);e.width(n)},setupSubtitles:function(){var t=this;this.subtitleObj={};var n=this.defaultVideo.subtitle;if(n){e.ajax({url:n,success:function(e){t.subtitleObj.loaded=true;t.subtitlesToArray(e);t.subtitleObj.count=0;t.subtitleObj.current=t.subtitleObj.content[t.subtitleObj.count]}});var r=e('<div id="subtitle-'+this.selector.attr("id")+'" class="'+this.setClass("subtitle")+'"></div>');var i=e('<div class="'+this.setClass("subtitle-content")+'"></div>');r.append(i);this.subtitleObj.element=r;this.selector.append(this.subtitleObj.element)}},setupTime:function(){var e=this.selector.find(this.getClass("time-display")),t=e.find(this.getClass("time-total"));e.find(this.getClass("time-current")).html(this.formatTime(0));e.find(this.getClass("time-separator")).html(this.options.timeSeparator);if(this.supportHTML5){t.html(this.formatTime(this.video.get(0).duration))}else{var n=this;this.getDurationInterval=setInterval(function(){if(n.video.get(0).duration()>0){t.html(n.formatTime(n.video.get(0).duration()));clearInterval(n.getDurationInterval)}},10)}},subtitlesToArray:function(e){this.subtitleObj.content=[];var t=e.search("\r\n")==-1?"\n":"\r\n";var n=e.split(t+t);for(var r=0;r<n.length;r++){if(n[r].length>0){this.subtitleObj.content.push(n[r].split(t))}}},timecodeToSec:function(e){if(e){tc1=e.split(",");tc2=tc1[0].split(":");seconds=Math.floor(tc2[0]*60*60)+Math.floor(tc2[1]*60)+Math.floor(tc2[2]);return seconds}},toFullscreen:function(){clearTimeout(this.fullscreenTimeout);var t=this;if(this.supportHTML5){if(!this.fullscreen){if(this.selector.get(0).webkitRequestFullScreen){this.selector.get(0).webkitRequestFullScreen()}else if(this.selector.get(0).mozRequestFullScreen){this.selector.get(0).mozRequestFullScreen()}}else{if(document.webkitCancelFullScreen){document.webkitCancelFullScreen()}else if(document.mozCancelFullScreen){document.mozCancelFullScreen()}}}else{var n=this.video.get(0);if(!this.fullscreen){this.selector.addClass("fullscreen");e(this.getClass("fullscreen")).removeClass("hover");this.fullscreen=true}else{this.selector.removeClass("fullscreen");e(this.getClass("fullscreen")).removeClass("hover");this.fullscreen=false}setTimeout(function(){t.setupProgressBar()},100)}},unblockSelection:function(){this.volumeFlag=false;document.onselectstart=function(){return true}},updateBuffer:function(e,t){var n;if(this.supportHTML5){if(e.buffered&&e.buffered.length>0){n=e.buffered.end(0)/e.duration;var r=n*100+"%";t.width(r);if(n==1){clearInterval(this.bufferInterval)}}else{t.width("100%");clearInterval(this.bufferInterval)}}else{n=e.getBuffer();var r=n*100+"%";t.width(r);if(n==1){clearInterval(this.bufferInterval)}}},updateCurrentTime:function(t){var n=this.supportHTML5?t.currentTime:t.currentTime();var r=e(t).parent().find(this.getClass("time-current"));r.html(this.formatTime(n))},updateSubtitle:function(e){var t=this.supportHTML5?e.currentTime:e.currentTime();if(t>this.getMinTime()&&t<this.getMaxTime()){this.subtitleObj.current=this.subtitleObj.content[this.subtitleObj.count];this.subtitleObj.subtitle=this.subtitleObj.current[2]}else{this.subtitleObj.subtitle=""}if(t>this.getMaxTime()){this.subtitleObj.count++;this.subtitleObj.current=this.subtitleObj.content[this.subtitleObj.count]}this.subtitleObj.element.find("div:first").html(this.subtitleObj.subtitle)},updateVideoData:function(e,t){var n=t.parent().find(this.getClass("progress-pointer"));var r=(this.supportHTML5?e.currentTime:e.currentTime())*100/(this.supportHTML5?e.duration:e.duration());t.width(r+"%");n.css("left",r+"%")},volumeSetup:function(){var t=this.video.get(0);var n=this.selector.find(this.getClass("volume-wrapper"));var r=e(this.getClass("volume"));var i=this;this.volumeFlag=false;n.bind("mousedown",function(s){s.preventDefault();i.blockSelection();e(document).bind("mousemove",function(e){e.preventDefault();i.volumeTo(e.pageY,n,t)});e(document).bind("mouseup",function(t){t.preventDefault();if(t.target.className.search("volume")<0){r.removeClass("hover")}i.unblockSelection();e(document).unbind("mousemove");e(document).unbind("mouseup")})});n.bind("mouseup",function(e){i.volumeTo(e.pageY,n,t)})},volumeTo:function(t,n,r){var i=e(this.getClass("volume-position"));var s=Math.max(0,Math.min(1,(t-n.offset().top)/n.height()));var o=(s-1)*-1;if(this.supportHTML5){r.volume=o}else{r.volume(o)}i.height(o*100+"%");var u=e(this.getClass("volume-button"));if(o<=0){u.addClass("muted")}else{u.removeClass("muted")}}};e.fn.jQPlayer=function(n){var r={controls:["play","progress","time","volume","fullscreen","alternative"],controlsClass:"video-controls",customButtons:{},defaultVideo:"standard",floatControls:false,onEnd:false,onPause:false,onPlay:false,onSeek:false,onStart:false,onVideoChange:false,prefix:"html-player-",timeSeparator:"/",videoId:"video-",fallbackOptions:{relativePath:"../",swf:"media/jQPlayer.swf"}};var n=e.extend(r,n);return new t(this,n)}})(jQuery)
